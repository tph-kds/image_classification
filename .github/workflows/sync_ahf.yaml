# name: Sync to Hugging Face hub

# on:
#   push:
#     branches: [main]
#   workflow_dispatch:

# env:
#   HF_USERNAME: vikenkd
#   HF_TOKEN: ${{ secrets.HF_TOKEN }}
#   SPACE_NAME: image_classification
#   EMAIL_USER: ${{ secrets.EMAIL_USER }}

# jobs:
#   sync-to-hub:
#     runs-on: ubuntu-latest

#     steps:
#       - uses: actions/checkout@v3
#         with:
#           fetch-depth: 0
#           lfs: true

#       - name: Configure Git
#         run: |
#           git config --global user.email "$EMAIL_USER"
#           git config --global user.name "tph-kds"

#       - name: Setup Git LFS
#         run: git lfs install

#       - name: Remove large/binary model files from history
#         run: |
#           pip install git-filter-repo
#           # Remove any checkpoints or .pth, .pt, .bin files from history
#           git filter-repo --path checkpoints/ --invert-paths --force || true
#           git filter-repo --path-glob '*.pth' --invert-paths --force || true
#           git filter-repo --path-glob '*.pt' --invert-paths --force || true
#           git filter-repo --path-glob '*.bin' --invert-paths --force || true
#           git add .
#           git commit -m "Clean binary files from history" || true

#       - name: Sync with origin (safe)
#         run: |
#           if git remote | grep origin; then
#             git fetch origin main || true
#             git rebase origin/main || true
#           else
#             echo "No origin remote found, skipping rebase."
#           fi

#       - name: Force push to Hugging Face Space
#         run: |
#           git remote add hf https://$HF_USERNAME:$HF_TOKEN@huggingface.co/spaces/$HF_USERNAME/$SPACE_NAME || true
#           git push hf main --force
